{"kind":"RuntimeSemantics","params":["x","evalRealm","strictCaller","direct"],"steps":[{"tokens":["Assert",":","If",{"id":"direct"},"is",{"value":"false"},",","then",{"id":"strictCaller"},"is","also",{"value":"false"},"."]},{"tokens":["If","Type","(",{"id":"x"},")","is","not","String",",","return",{"id":"x"},"."]},{"tokens":["Let",{"id":"thisEnvRec"},"be","!","GetThisEnvironment","(",")","."]},{"tokens":["If",{"id":"thisEnvRec"},"is","a","function","Environment","Record",",","then",{"steps":[{"tokens":["Let",{"id":"F"},"be",{"id":"thisEnvRec"},".","[","[","FunctionObject","]","]","."]},{"tokens":["Let",{"id":"inFunction"},"be",{"value":"true"},"."]},{"tokens":["Let",{"id":"inMethod"},"be",{"id":"thisEnvRec"},".","HasSuperBinding","(",")","."]},{"tokens":["If",{"id":"F"},".","[","[","ConstructorKind","]","]","is",{"code":"\"derived\""},",","let",{"id":"inDerivedConstructor"},"be",{"value":"true"},";","otherwise",",","let",{"id":"inDerivedConstructor"},"be",{"value":"false"},"."]}]}]},{"tokens":["Else",",",{"steps":[{"tokens":["Let",{"id":"inFunction"},"be",{"value":"false"},"."]},{"tokens":["Let",{"id":"inMethod"},"be",{"value":"false"},"."]},{"tokens":["Let",{"id":"inDerivedConstructor"},"be",{"value":"false"},"."]}]}]},{"tokens":["Let",{"id":"script"},"be","the","ECMAScript","code","that","is","the","result","of","parsing",{"id":"x"},",","interpreted","as","UTF","-","16","encoded","Unicode","text","as","described","in","6",".","1",".","4",",","for","the","goal","symbol",{"nt":"Script"},".","If",{"id":"inFunction"},"is",{"value":"false"},",","additional","early","error","rules","from","18",".","2",".","1",".","1",".","1","are","applied",".","If",{"id":"inMethod"},"is",{"value":"false"},",","additional","early","error","rules","from","18",".","2",".","1",".","1",".","2","are","applied",".","If",{"id":"inDerivedConstructor"},"is",{"value":"false"},",","additional","early","error","rules","from","18",".","2",".","1",".","1",".","3","are","applied",".","If","the","parse","fails",",","throw","a",{"value":"SyntaxError"},"exception",".","If","any","early","errors","are","detected",",","throw","a",{"value":"SyntaxError"},"or","a",{"value":"ReferenceError"},"exception",",","depending","on","the","type","of","the","error","(","but","see","also","clause","16",")",".","Parsing","and","early","error","detection","may","be","interweaved","in","an","implementation","-","dependent","manner","."]},{"tokens":["If",{"id":"script"},"Contains",{"nt":"ScriptBody"},"is",{"value":"false"},",","return",{"value":"undefined"},"."]},{"tokens":["Let",{"id":"body"},"be","the",{"nt":"ScriptBody"},"of",{"id":"script"},"."]},{"tokens":["If",{"id":"strictCaller"},"is",{"value":"true"},",","let",{"id":"strictEval"},"be",{"value":"true"},"."]},{"tokens":["Else",",","let",{"id":"strictEval"},"be","IsStrict","of",{"id":"script"},"."]},{"tokens":["Let",{"id":"ctx"},"be","the","running","execution","context","."]},{"tokens":["NOTE",":","If",{"id":"direct"},"is",{"value":"true"},",",{"id":"ctx"},"will","be","the","execution","context","that","performed","the","direct","eval",".","If",{"id":"direct"},"is",{"value":"false"},",",{"id":"ctx"},"will","be","the","execution","context","for","the","invocation","of","the",{"code":"eval"},"function","."]},{"tokens":["If",{"id":"direct"},"is",{"value":"true"},",","then",{"steps":[{"tokens":["Let",{"id":"lexEnv"},"be","NewDeclarativeEnvironment","(",{"id":"ctx"},"'","s","LexicalEnvironment",")","."]},{"tokens":["Let",{"id":"varEnv"},"be",{"id":"ctx"},"'","s","VariableEnvironment","."]}]}]},{"tokens":["Else",",",{"steps":[{"tokens":["Let",{"id":"lexEnv"},"be","NewDeclarativeEnvironment","(",{"id":"evalRealm"},".","[","[","GlobalEnv","]","]",")","."]},{"tokens":["Let",{"id":"varEnv"},"be",{"id":"evalRealm"},".","[","[","GlobalEnv","]","]","."]}]}]},{"tokens":["If",{"id":"strictEval"},"is",{"value":"true"},",","set",{"id":"varEnv"},"to",{"id":"lexEnv"},"."]},{"tokens":["If",{"id":"ctx"},"is","not","already","suspended",",","suspend",{"id":"ctx"},"."]},{"tokens":["Let",{"id":"evalCxt"},"be","a","new","ECMAScript","code","execution","context","."]},{"tokens":["Set","the",{"id":"evalCxt"},"'","s","Function","to",{"value":"null"},"."]},{"tokens":["Set","the",{"id":"evalCxt"},"'","s","Realm","to",{"id":"evalRealm"},"."]},{"tokens":["Set","the",{"id":"evalCxt"},"'","s","ScriptOrModule","to",{"id":"ctx"},"'","s","ScriptOrModule","."]},{"tokens":["Set","the",{"id":"evalCxt"},"'","s","VariableEnvironment","to",{"id":"varEnv"},"."]},{"tokens":["Set","the",{"id":"evalCxt"},"'","s","LexicalEnvironment","to",{"id":"lexEnv"},"."]},{"tokens":["Push",{"id":"evalCxt"},"on","to","the","execution","context","stack",";",{"id":"evalCxt"},"is","now","the","running","execution","context","."]},{"tokens":["Let",{"id":"result"},"be","EvalDeclarationInstantiation","(",{"id":"body"},",",{"id":"varEnv"},",",{"id":"lexEnv"},",",{"id":"strictEval"},")","."]},{"tokens":["If",{"id":"result"},".","[","[","Type","]","]","is",{"const":"normal"},",","then",{"steps":[{"tokens":["Set",{"id":"result"},"to","the","result","of","evaluating",{"id":"body"},"."]}]}]},{"tokens":["If",{"id":"result"},".","[","[","Type","]","]","is",{"const":"normal"},"and",{"id":"result"},".","[","[","Value","]","]","is",{"const":"empty"},",","then",{"steps":[{"tokens":["Set",{"id":"result"},"to","NormalCompletion","(",{"value":"undefined"},")","."]}]}]},{"tokens":["Suspend",{"id":"evalCxt"},"and","remove","it","from","the","execution","context","stack","."]},{"tokens":["Resume","the","context","that","is","now","on","the","top","of","the","execution","context","stack","as","the","running","execution","context","."]},{"tokens":["Return","Completion","(",{"id":"result"},")","."]}],"length":4,"filename":"es2018/algorithm/PerformEval.json"}