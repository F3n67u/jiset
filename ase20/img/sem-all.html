<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
.infolayer [class^='y'][class$='title'] {
  transform: rotate(0deg) translate(-10px);
}
  </style>
</head>
<div id="myDiv"></div>
<script>
  // color: ['#4F732C', '#BF1515'],

  let green = '#080';
  let red = '#A00';
  let white = '#FFF';

  function createBase(color, yaxis, data, kind, text, pos) {
    return {
      x: data,
      y: ['T ', 'L ', 'B '],
      type: 'bar',
      name: kind,
      yaxis: yaxis,
      text: text,
      textposition: pos,
      textfont: {
        size: 1000,
      },
      barmode: 'stack',
      orientation: 'h',
      marker: {color: color}
    };
  }

  function createDummy(yaxis) {
    return {
      x: [''],
      y: [''],
      type: 'bar',
      yaxis: yaxis,
      barmode: 'stack',
      orientation: 'h',
    }
  }

  function createAuto(yaxis, data) {
    return createBase(green, yaxis, data, 'auto', data, 'none');
  }
  function createManual(yaxis, data) {
    return createBase(red, yaxis, data, 'manual', data, 'none');
  }
  function createTotal(yaxis, data, total) {
    let text = [];
    for (let i = 0; i < 3; i++) {
      text[i] = `<b>${data[i]} / ${total[i]}</b> (${(data[i] / total[i] * 100).toFixed(2)}%)`;
    }
    // text[0] = (data[0] / total[0] * 100).toFixed(2) + '%';
    // text[1] = (data[1] / total[1] * 100).toFixed(2) + '%';
    // text[2] = (data[2] / total[2] * 100).toFixed(2) + '%';
    return createBase(white, yaxis, [0,0,0], '', text, 'outside');
  }

  function createModel(yaxis, pass, fail, total) {
    return [createAuto(yaxis, pass), createManual(yaxis, fail), createTotal(yaxis, pass, total)];
  }

  Plotly.newPlot(
    "myDiv",
    [].concat(
      createModel('y1', [8901, 5115, 3786], [773, 221, 552], [9674, 5336, 4338]),
      createModel('y2', [8744, 5042, 3702], [758, 221, 537], [9502, 5263, 4239]),
      createModel('y3', [8456, 4779, 3677], [881, 259, 622], [9337, 5038, 4299]),
      createModel('y4', [7832, 4579, 3253], [789, 296, 493], [8621, 4875, 3746]),

      // createModel('y1', [1069, 371, 698], [115, 22, 93], [1184, 393, 791]),
      // createModel('y2', [1472, 694, 778], [99, 23, 76], [1571, 717, 854]),
      // createModel('y3', [2700, 1512, 1188], [237, 51, 186], [2937, 1563, 1374]),
      [
        createDummy('y5'),
        createDummy('y6'),
        createDummy('y7'),
      ]
    ),
    {
      barmode: "stack",
      title: "T: Total   L: Language   B: Built-in",
      xaxis: {
        domain: [0, 20000],
        dtick: 1000,
        separatethousands: 'true',
        title: '# Steps',
        tickformat: ',4d',
        // visible: false,
      },
      yaxis1: {
        domain: [0.03, 0.22],
        anchor: 'y1',
        title: 'ES10',
        autorange: 'reversed',
      },
      yaxis2: {
        domain: [0.28, 0.47],
        anchor: 'y2',
        title: 'ES9',
        autorange: 'reversed',
      },
      yaxis3: {
        domain: [0.53, 0.72],
        anchor: 'y3',
        title: 'ES8',
        autorange: 'reversed',
      },
      yaxis4: {
        domain: [0.78, 0.97],
        anchor: 'y4',
        title: 'ES7',
        autorange: 'reversed',
      },
      yaxis5: { domain: [0.22, 0.28] },
      yaxis6: { domain: [0.47, 0.53] },
      yaxis7: { domain: [0.72, 0.78] },
    },
    {responsive: true}
  );
</script>
