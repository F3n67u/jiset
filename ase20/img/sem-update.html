<head>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
.infolayer [class^='y'][class$='title'] {
  transform: rotate(0deg) translate(-10px);
}
  </style>
</head>
<div id="myDiv"></div>
<script>
  // color: ['#4F732C', '#BF1515'],

  let green = '#080';
  let red = '#A00';
  let white = '#FFF';

  function createBase(color, yaxis, data, kind, text, pos) {
    return {
      x: data,
      y: ['T ', 'L ', 'B '],
      type: 'bar',
      name: kind,
      yaxis: yaxis,
      text: text,
      textposition: pos,
      textfont: {
        size: 1000,
      },
      barmode: 'stack',
      orientation: 'h',
      marker: {color: color}
    };
  }

  function createDummy(yaxis) {
    return {
      x: [''],
      y: [''],
      type: 'bar',
      yaxis: yaxis,
      barmode: 'stack',
      orientation: 'h',
    }
  }

  function createAuto(yaxis, data) {
    return createBase(green, yaxis, data, 'auto', data, 'none');
  }
  function createManual(yaxis, data) {
    return createBase(red, yaxis, data, 'manual', data, 'none');
  }
  function createTotal(yaxis, data, total) {
    let text = [];
    for (let i = 0; i < 3; i++) {
      text[i] = `<b>${data[i]} / ${total[i]}</b> (${(data[i] / total[i] * 100).toFixed(2)}%)`;
    }
    return createBase(white, yaxis, [0,0,0], '', text, 'outside');
  }

  function createModel(yaxis, pass, fail, total) {
    return [createAuto(yaxis, pass), createManual(yaxis, fail), createTotal(yaxis, pass, total)];
  }

  Plotly.newPlot(
    "myDiv",
    [].concat(
      createModel('y1', [2563.7, 1314.3, 1249.3], [154.7, 38.7, 116.0], [2718.3, 1353.0, 1365.3]),
      createModel('y2', [1559, 736, 823], [55, 6, 49], [1614, 742, 872]),
      createModel('y3', [3015, 1660, 1355], [153, 37, 116], [3168, 1697, 1471]),
      createModel('y4', [3117, 1547, 1570], [256, 73, 183], [3373, 1620, 1753]),
      [
        createDummy('y5'),
        createDummy('y6'),
        createDummy('y7'),
      ]
    ),
    {
      barmode: "stack",
      title: "<b>T:</b> Total   <b>L:</b> Core Language Semantics   <b>B:</b> Built-in Libraries",
      xaxis: {
        domain: [0, 20000],
        dtick: 500,
        separatethousands: 'true',
        title: 'Î” # Steps',
        tickformat: ',4d',
        // visible: false,
      },
      yaxis1: {
        domain: [0.02, 0.18],
        anchor: 'y1',
        title: 'Average',
        autorange: 'reversed',
      },
      yaxis2: {
        domain: [0.22, 0.38],
        anchor: 'y2',
        title: 'ES9-10',
        autorange: 'reversed',
      },
      yaxis3: {
        domain: [0.42, 0.58],
        anchor: 'y3',
        title: 'ES8-9',
        autorange: 'reversed',
      },
      yaxis4: {
        domain: [0.62, 0.78],
        anchor: 'y4',
        title: 'ES7-8',
        autorange: 'reversed',
      },
      yaxis5: { domain: [0.18, 0.22] },
      yaxis6: { domain: [0.38, 0.42] },
      yaxis7: { domain: [0.58, 0.62] },
      showlegend: false
    },
    {responsive: true}
  );
</script>
