{"kind":"RuntimeSemantics","lang":false,"params":["x","callerRealm","strictCaller","direct"],"steps":[{"tokens":["Assert",":","If",{"id":"direct"},"is",{"value":"false"},",","then",{"id":"strictCaller"},"is","also",{"value":"false"},"."]},{"tokens":["If","Type","(",{"id":"x"},")","is","not","String",",","return",{"id":"x"},"."]},{"tokens":["Let",{"id":"evalRealm"},"be","the","current","Realm","Record","."]},{"tokens":["Perform","?","HostEnsureCanCompileStrings","(",{"id":"callerRealm"},",",{"id":"evalRealm"},")","."]},{"tokens":["Let",{"id":"thisEnvRec"},"be","!","GetThisEnvironment","(",")","."]},{"tokens":["If",{"id":"thisEnvRec"},"is","a","function","Environment","Record",",","then",{"steps":[{"tokens":["Let",{"id":"F"},"be",{"id":"thisEnvRec"},".","[","[","FunctionObject","]","]","."]},{"tokens":["Let",{"id":"inFunction"},"be",{"value":"true"},"."]},{"tokens":["Let",{"id":"inMethod"},"be",{"id":"thisEnvRec"},".","HasSuperBinding","(",")","."]},{"tokens":["If",{"id":"F"},".","[","[","ConstructorKind","]","]","is",{"const":"derived"},",","let",{"id":"inDerivedConstructor"},"be",{"value":"true"},";","otherwise",",","let",{"id":"inDerivedConstructor"},"be",{"value":"false"},"."]}]}]},{"tokens":["Else",",",{"steps":[{"tokens":["Let",{"id":"inFunction"},"be",{"value":"false"},"."]},{"tokens":["Let",{"id":"inMethod"},"be",{"value":"false"},"."]},{"tokens":["Let",{"id":"inDerivedConstructor"},"be",{"value":"false"},"."]}]}]},{"tokens":["Perform","the","following","substeps","in","an","implementation","-","dependent","order",",","possibly","interleaving","parsing","and","error","detection",":",{"steps":[{"tokens":["Let",{"id":"script"},"be","the","ECMAScript","code","that","is","the","result","of","parsing","!","UTF16DecodeString","(",{"id":"x"},")",",","for","the","goal","symbol",{"nt":"Script"},".","If","the","parse","fails",",","throw","a",{"value":"SyntaxError"},"exception",".","If","any","early","errors","are","detected",",","throw","a",{"value":"SyntaxError"},"exception","(","but","see","also","clause","16",")","."]},{"tokens":["If",{"id":"script"},"Contains",{"nt":"ScriptBody"},"is",{"value":"false"},",","return",{"value":"undefined"},"."]},{"tokens":["Let",{"id":"body"},"be","the",{"nt":"ScriptBody"},"of",{"id":"script"},"."]},{"tokens":["If",{"id":"inFunction"},"is",{"value":"false"},",","and",{"id":"body"},"Contains",{"nt":"NewTarget"},",","throw","a",{"value":"SyntaxError"},"exception","."]},{"tokens":["If",{"id":"inMethod"},"is",{"value":"false"},",","and",{"id":"body"},"Contains",{"nt":"SuperProperty"},",","throw","a",{"value":"SyntaxError"},"exception","."]},{"tokens":["If",{"id":"inDerivedConstructor"},"is",{"value":"false"},",","and",{"id":"body"},"Contains",{"nt":"SuperCall"},",","throw","a",{"value":"SyntaxError"},"exception","."]}]}]},{"tokens":["If",{"id":"strictCaller"},"is",{"value":"true"},",","let",{"id":"strictEval"},"be",{"value":"true"},"."]},{"tokens":["Else",",","let",{"id":"strictEval"},"be","IsStrict","of",{"id":"script"},"."]},{"tokens":["Let",{"id":"runningContext"},"be","the","running","execution","context","."]},{"tokens":["NOTE",":","If",{"id":"direct"},"is",{"value":"true"},",",{"id":"runningContext"},"will","be","the","execution","context","that","performed","the","direct","eval",".","If",{"id":"direct"},"is",{"value":"false"},",",{"id":"runningContext"},"will","be","the","execution","context","for","the","invocation","of","the",{"code":"eval"},"function","."]},{"tokens":["If",{"id":"direct"},"is",{"value":"true"},",","then",{"steps":[{"tokens":["Let",{"id":"lexEnv"},"be","NewDeclarativeEnvironment","(",{"id":"runningContext"},"'","s","LexicalEnvironment",")","."]},{"tokens":["Let",{"id":"varEnv"},"be",{"id":"runningContext"},"'","s","VariableEnvironment","."]}]}]},{"tokens":["Else",",",{"steps":[{"tokens":["Let",{"id":"lexEnv"},"be","NewDeclarativeEnvironment","(",{"id":"evalRealm"},".","[","[","GlobalEnv","]","]",")","."]},{"tokens":["Let",{"id":"varEnv"},"be",{"id":"evalRealm"},".","[","[","GlobalEnv","]","]","."]}]}]},{"tokens":["If",{"id":"strictEval"},"is",{"value":"true"},",","set",{"id":"varEnv"},"to",{"id":"lexEnv"},"."]},{"tokens":["If",{"id":"runningContext"},"is","not","already","suspended",",","suspend",{"id":"runningContext"},"."]},{"tokens":["Let",{"id":"evalContext"},"be","a","new","ECMAScript","code","execution","context","."]},{"tokens":["Set",{"id":"evalContext"},"'","s","Function","to",{"value":"null"},"."]},{"tokens":["Set",{"id":"evalContext"},"'","s","Realm","to",{"id":"evalRealm"},"."]},{"tokens":["Set",{"id":"evalContext"},"'","s","ScriptOrModule","to",{"id":"runningContext"},"'","s","ScriptOrModule","."]},{"tokens":["Set",{"id":"evalContext"},"'","s","VariableEnvironment","to",{"id":"varEnv"},"."]},{"tokens":["Set",{"id":"evalContext"},"'","s","LexicalEnvironment","to",{"id":"lexEnv"},"."]},{"tokens":["Push",{"id":"evalContext"},"onto","the","execution","context","stack",";",{"id":"evalContext"},"is","now","the","running","execution","context","."]},{"tokens":["Let",{"id":"result"},"be","EvalDeclarationInstantiation","(",{"id":"body"},",",{"id":"varEnv"},",",{"id":"lexEnv"},",",{"id":"strictEval"},")","."]},{"tokens":["If",{"id":"result"},".","[","[","Type","]","]","is",{"const":"normal"},",","then",{"steps":[{"tokens":["Set",{"id":"result"},"to","the","result","of","evaluating",{"id":"body"},"."]}]}]},{"tokens":["If",{"id":"result"},".","[","[","Type","]","]","is",{"const":"normal"},"and",{"id":"result"},".","[","[","Value","]","]","is",{"const":"empty"},",","then",{"steps":[{"tokens":["Set",{"id":"result"},"to","NormalCompletion","(",{"value":"undefined"},")","."]}]}]},{"tokens":["Suspend",{"id":"evalContext"},"and","remove","it","from","the","execution","context","stack","."]},{"tokens":["Resume","the","context","that","is","now","on","the","top","of","the","execution","context","stack","as","the","running","execution","context","."]},{"tokens":["Return","Completion","(",{"id":"result"},")","."]}],"length":4,"filename":"es2020/algorithm/PerformEval.json"}